<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0062)http://members.fortunecity.com/peterhull/Frame_Rate_Demos.html -->
<HTML xmlns="http://www.w3.org/TR/REC-html40" xmlns:v = 
"urn:schemas-microsoft-com:vml" xmlns:o = 
"urn:schemas-microsoft-com:office:office" xmlns:w = 
"urn:schemas-microsoft-com:office:word"><HEAD><TITLE>Frame Rate Demos</TITLE>
<META content="text/html; charset=iso-8859-1" http-equiv=Content-Type>
<META name=ProgId content=Word.Document>
<META name=GENERATOR content="MSHTML 8.00.7600.16535">
<META name=Originator content="Microsoft Word 9"><LINK rel=File-List 
href="./Frame_Rate_Demos_files/filelist.xml"><LINK rel=Edit-Time-Data 
href="./Frame_Rate_Demos_files/editdata.mso"><!--[if !mso]>
<STYLE>v\:* {
	BEHAVIOR: url(#default#VML)
}
o\:* {
	BEHAVIOR: url(#default#VML)
}
w\:* {
	BEHAVIOR: url(#default#VML)
}
.shape {
	BEHAVIOR: url(#default#VML)
}
</STYLE>
<![endif]--><!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Peter</o:Author>
  <o:LastAuthor>Peter</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>14</o:TotalTime>
  <o:Created>2001-09-29T14:54:00Z</o:Created>
  <o:LastSaved>2001-09-29T15:08:00Z</o:LastSaved>
  <o:Pages>3</o:Pages>
  <o:Words>1161</o:Words>
  <o:Characters>6619</o:Characters>
  <o:Lines>55</o:Lines>
  <o:Paragraphs>13</o:Paragraphs>
  <o:CharactersWithSpaces>8128</o:CharactersWithSpaces>
  <o:Version>9.2720</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<STYLE>@page Section1 {size: 8.5in 11.0in; margin: 1.0in 1.25in 1.0in 1.25in; mso-header-margin: .5in; mso-footer-margin: .5in; mso-paper-source: 0; }
P.MsoNormal {
	MARGIN: 0in 0in 0pt; FONT-FAMILY: "Times New Roman"; FONT-SIZE: 12pt; mso-style-parent: ""; mso-pagination: widow-orphan; mso-fareast-font-family: "Times New Roman"
}
LI.MsoNormal {
	MARGIN: 0in 0in 0pt; FONT-FAMILY: "Times New Roman"; FONT-SIZE: 12pt; mso-style-parent: ""; mso-pagination: widow-orphan; mso-fareast-font-family: "Times New Roman"
}
DIV.MsoNormal {
	MARGIN: 0in 0in 0pt; FONT-FAMILY: "Times New Roman"; FONT-SIZE: 12pt; mso-style-parent: ""; mso-pagination: widow-orphan; mso-fareast-font-family: "Times New Roman"
}
CODE {
	mso-fareast-font-family: "Courier New"; mso-ascii-font-family: "Courier New"; mso-hansi-font-family: "Courier New"; mso-bidi-font-family: "Courier New"
}
DIV.Section1 {
	page: Section1
}
OL {
	MARGIN-BOTTOM: 0in
}
UL {
	MARGIN-BOTTOM: 0in
}
</STYLE>
</HEAD>
<BODY style="tab-interval: .5in" lang=EN-US link=blue vLink=blue>
<CENTER>
<SCRIPT language=Javascript>
<!--

function FCGetWindowSize() {
  var FCmyWidth = 800, FCmyHeight = 600;
  if( typeof( window.innerWidth ) == 'number' ) {
    //Non-IE
    FCmyWidth = window.innerWidth;
    FCmyHeight = window.innerHeight;
  } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {
    //IE 6+ in 'standards compliant mode'
    FCmyWidth = document.documentElement.clientWidth;
    FCmyHeight = document.documentElement.clientHeight;
  } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
    //IE 4 compatible
    FCmyWidth = document.body.clientWidth;
    FCmyHeight = document.body.clientHeight;
  }
  FCWindowWidth = FCmyWidth;
  if (FCmyHeight < 200) { FCWindowWidth = 1; }
}

FCGetWindowSize();

var fcadunit = 'misc';		// default

var GiveMePopups = 1;

// -->
</SCRIPT>

<SCRIPT language=Javascript src="Frame%20Rate%20Demos_files/adscript.global.js">
</SCRIPT>
<!-- google_ad_section_start(weight=ignore) -->
<TABLE style="VISIBILITY: hidden" id=fcnavbartable border=0 cellSpacing=0 
cellPadding=0 width=730>
  <TBODY>
  <TR id=fcnavbartablerow align=middle>
    <TD>
      <TABLE border=0 cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR align=middle>
          <TD width="3%"><A id=fcnavlogo href="http://www.fortunecity.com/" 
            target=_new><IMG border=0 
            alt="web hosting, domain name, free web site, email address" 
            src="Frame%20Rate%20Demos_files/fc_mp_logo_left.gif" width=160 
            height=45></A></TD>
          <TD id=fctdhosting width="22%"><A 
            style="FONT-FAMILY: Verdana,sans-serif; FONT-SIZE: 11px; FONT-WEIGHT: bold" 
            id=fcnavhosting href="http://www.fortunecity.com/?sid=fcnavhosting" 
            target=_new>Web hosting</A></TD>
          <TD id=fctddomains width="24%"><A 
            style="FONT-FAMILY: Verdana,sans-serif; FONT-SIZE: 11px; FONT-WEIGHT: bold" 
            id=fcnavdomains href="http://www.fortunecity.com/email/" 
            target=_new>Custom Email</A></TD>
          <TD id=fctdemail width="26%"><A 
            style="FONT-FAMILY: Verdana,sans-serif; FONT-SIZE: 11px; FONT-WEIGHT: bold" 
            id=fcnavmpa href="http://www.fortunecity.com/sitebuilder/" 
            target=_new>SiteBuilder</A></TD>
          <TD id=fcnavsrchsub width="2%"><IMG border=0 alt="" 
            src="Frame%20Rate%20Demos_files/fc_mp_logo_right.gif" width=30 
            height=45></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><!-- google_ad_section_end -->
<SCRIPT language=Javascript>
<!--

DisplayFCAdBanner();

document.getElementById('fcnavhosting').search = '?sid=fcnavhosting';
document.getElementById('fcnavmpa').search = '?sid=fcnavmpa';

// -->
</SCRIPT>
<BR>
<DIV style="HEIGHT: 5px"></DIV>
<SCRIPT language=Javascript>
<!-- 

DisplayFCAdButtons();

// -->
</SCRIPT>
</CENTER>
<DIV class=Section1>
<H1>Frame Rate Demos</H1>
<P style="MARGIN-BOTTOM: 12pt" class=MsoNormal>By Pete<BR><A 
href="mailto:peterhull90@hotmail.com">peterhull90@hotmail.com</A></P>
<H2>Introduction</H2>
<P style="MARGIN-BOTTOM: 12pt" class=MsoNormal>For real time games, you will 
want to specify the frame rate at which it runs. Unfortunately, there is a huge 
range of PC hardware and software combinations out there, so you can't assume 
that everyone will experience your creation at the same speed as it is on your 
machine. Fortunately, Allegro makes it <I>very</I> easy to do this correctly. 
It's in the FAQ, but it is surprising how many games don't bother to implement 
it.</P>
<H2>Example code</H2>
<P class=MsoNormal>The code here uses a simple bouncing circle to illustrate the 
point. Such simple animation should run OK on all but the oldest PCs. I have 
includes a pretend delay to simulate the effect of doing lots of processing, 
which will slow down your <I>maximum </I>frame rate. In real life, this would be 
moving objects, collision detection, AI, and so on. Another chunk of processing 
time is taken up by composing the screen; drawing backgrounds, objects and 
characters. It's sometimes useful to split these two activities up, as I will 
demonstrate later.<BR><BR>The code is written in C, it will compile under 
DJGPP/DOS using the latest Allegro. I've also checked it under MinGW/WindowsMe. 
Feel free to use and modify it, subject to the usual Allegro 
"std_disclaimer.h"<BR>It should also work on other platforms, let me know if 
not.</P>
<H3>Example 0 (<A 
href="http://members.fortunecity.com/peterhull/t0.html">t0.c</A>)</H3>
<P class=MsoNormal>This is just the skeleton, with no control. On my system, it 
achieves 200 fps - yours might be faster or slower. Use the +/- keys on the 
keypad to introduce a pretend processing delay. You'll see that the frame rate 
is very dependent on that, as explained in the following diagram. Time is on the 
horizontal axis.</P>
<P><IMG alt="Slow computer" src="Frame%20Rate%20Demos_files/slow.gif">(Slow 
computer)<BR><IMG alt="Fast computer" 
src="Frame%20Rate%20Demos_files/fast.gif">(Fast computer)<BR><IMG alt=Key 
src="Frame%20Rate%20Demos_files/key.gif" width=220></P>
<P class=MsoNormal>For the fast computer, processing the logic and drawing the 
graphics just takes less time, so the frame rate goes up.</P>
<P class=MsoNormal><![if !supportEmptyParas]><![endif]>&nbsp;<o:p></o:p></P>
<H3>Example 1 (<A 
href="http://members.fortunecity.com/peterhull/t1.html">t1.c</A>) Simple 
Delay</H3>
<P class=MsoNormal>Suppose we want to cut our frame rate right down to 25 fps. 
Assuming the processing takes no time at all, we just introduce a delay of 1/25 
sec, i.e.. 40 ms. we can then allow for the processing time by tweaking the 40 
down a bit, until it looks about right. If the processing per frame really is 
very short compared to the frame rate, this method is OK. In general though, 
there are three problems:</P>
<OL type=1>
  <LI 
  style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l0 level1 lfo1; tab-stops: list .5in" 
  class=MsoNormal>Any PC with a different speed to yours will play differently 
  (more so, the bigger proportion of the 40 ms is processing time) 
  <LI 
  style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l0 level1 lfo1; tab-stops: list .5in" 
  class=MsoNormal>If you're running windows / Linux, then other running 
  processes can change your effective speed. 
  <LI 
  style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l0 level1 lfo1; tab-stops: list .5in" 
  class=MsoNormal>If the amount of stuff you need to do each frame changes, so 
  will the speed. For example, you'd see a slowdown if a lot of enemies come 
  into view at the same time. (If anyone remembers Knight Lore on the ZX 
  Spectrum - groundbreaking game, terrible slowdown problems!) </LI></OL>
<P class=MsoNormal>And there's a further difficulty - as you develop the game, 
the amount of processing may change. You add more features, or do things more 
efficiently, or switch between debug (no optimization) and release (optimized) 
versions. You'll need to keep altering that delay.</P>
<H3>Example 2 (<A 
href="http://members.fortunecity.com/peterhull/t2.html">t2.c</A>) Vsync 
control</H3>
<P class=MsoNormal>This is a not recommended, but the VGA does have a vertical 
interrupt every 50-70ish frames per second, and you can synchronize on this. 
Just call<BR><CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt">vsync();</SPAN></CODE><BR>every 
frame. I think Allegro simulates the vsync for modes that don't have it. Anyway, 
it's very crude, as you have to stick to one rate. I would say, don't so 
this.</P>
<H3>Example 3 (<A 
href="http://members.fortunecity.com/peterhull/t3.html">t3.c</A>) Ticker 
control</H3>
<P class=MsoNormal>This is a much better way. You use Allegro's timer facility 
to set an event every 40 ms. you then do your frame and wait for the event to 
occur. In the following diagram, the ticker is shown as the black line on the 
top. If a tick has not occurred, the program will simply wait. So, as long as 
the total processing does not take <I>more</I><SPAN 
style="mso-bidi-font-style: italic"> than 40ms, the program will have the 
correct frame rate regardless of what computer it runs on.<o:p></o:p></SPAN></P>
<P><IMG alt="Slow computer" src="Frame%20Rate%20Demos_files/slow_w.gif">(Slow 
computer)<BR><IMG alt="Fast computer" 
src="Frame%20Rate%20Demos_files/fast_w.gif">(Fast computer)<BR><IMG alt=Key 
src="Frame%20Rate%20Demos_files/key.gif" width=220></P>
<P class=MsoNormal>In more detail, you need a variable to signal that the event 
has occurred, anta function to be called, by the system, which updates 
it.<BR><CODE><SPAN style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt">volatile 
int ticks;</SPAN></CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt; mso-fareast-font-family: 'Courier New'"><BR><CODE>void 
ticker(void)</CODE><BR><CODE>{</CODE><BR><CODE>&nbsp;&nbsp; 
++ticks;</CODE><BR><CODE>} END_OF_FUNCTION(ticker);</CODE></SPAN><BR>The 
<CODE><SPAN style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt">volatile 
</SPAN></CODE>tells the compiler that this variable might change at any time in 
your main program. The <CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt">END_OF_FUNCTION 
</SPAN></CODE>is a bit of mechanics that lets us lock the function in memory 
(see the FAQ/Allegro manual for why this is needed).<BR>Next, you need to do 
that locking, only once, at the start of your program<BR><CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt">LOCK_FUNCTION(ticker);</SPAN></CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt; mso-fareast-font-family: 'Courier New'"><BR><CODE>LOCK_VARIABLE(ticks);</CODE></SPAN><BR>Now, 
start a timer running at 25 fps.<BR><CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt">install_int_ex(ticker, 
BPS_TO_TIMER(25));</SPAN></CODE><BR>You can also do this once, at the start of 
the program. It doesn't do much harm to leave it running, but make sure you 
don't keep calling it, or you can run in to problems. The number of timers is 
limited, so to be super correct, use install_int_ex just before you need it and 
use remove_int when finished.<BR>The final bit&nbsp;goes in the main loop; it 
just waits for the event to occur<BR><CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt">while 
(ticks&lt;1)</SPAN></CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt; mso-fareast-font-family: 'Courier New'"><BR><CODE>{</CODE><BR><CODE>&nbsp; 
&nbsp; 
yield_timeslice();</CODE><BR><CODE>}</CODE><BR><CODE>ticks=0;</CODE></SPAN><BR>In 
other words, wait in an endless loop for ticker to increment ticks. Then reset 
ticks. The loop continues, and time elapses, until it gets back here. <BR>If you 
try example 3, you will see that you can alter the pretend delay quite a lot, 
and the program will stay steady on 25 fps. If you exceed 40 ms (or so) on the 
delay, the rate will drop. This corresponds to the PC going flat out; there’s 
too much processing for it to achieve this frame rate.</P>
<H3>Example 4 (<A 
href="http://members.fortunecity.com/peterhull/t4.html">t4.c</A>) Ticker control 
with skipping</H3>
<P class=MsoNormal>As a small refinement, you will often find that actually 
composing an image and blitting it to the screen is the slowest part of the 
processing. If you don't do this, you can 'catch up' on frames, at the expense 
of making it jerky. In the following diagram, the graphics time has gone up so 
that a complete cycle of logic and graphics takes too long. If the tick has 
already occurred when the program starts to draw the graphics, it skips this 
stage and does two logic blocks in a row.</P>
<P><IMG alt="Skip computer" src="Frame%20Rate%20Demos_files/skip.gif"><BR><IMG 
alt=Key src="Frame%20Rate%20Demos_files/key.gif" width=220></P>
<P class=MsoNormal>Example 4 splits the delay in two, with a fixed portion (25 
ms) for the graphics. The extra line<BR><CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt">if 
(ticks==0)</SPAN></CODE><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt; mso-fareast-font-family: 'Courier New'"><BR><CODE>{</CODE><BR><CODE>&nbsp; 
&nbsp; /* draw graphics 
*/</CODE><BR><CODE>...</CODE><BR><CODE>}</CODE></SPAN><BR>only does the graphics 
if we haven't already exceeded our 40 ms. Try the program; you'll see it going 
jerky as you pass 40 ms. In the limit, there's only enough time to do the logic, 
and the graphics never get updated.<BR>You can go to town on this, for example 
drawing more elaborate explosions if the PC is fast enough. Only bother if 
you've really got nothing better to do!</P>
<H3>Example 5 (<A 
href="http://members.fortunecity.com/peterhull/tx.html">tx.c</A>) Predictable 
frames</H3>
<P class=MsoNormal>Another special case is when you can draw frame N without 
needing to go through previous frames. You can't do it in a game, because what 
happens must depend on what the player's been doing up to that point. But for a 
title page, you might have some rotating things, scrolling text, something of 
that nature. In that case, you can use a ticker as before, but run your loop at 
full speed, potentially redrawing the same image many times. In the example, 
you'll see a rotating cross. The image for frame N is the cross, rotated by N 
"Allegro degrees" - in other words, it rotates a full circle every 256 frames. I 
could draw frame 99, say, without drawing any others. As you increase the delay, 
the cross rotates at the same speed, but it is jerkier. For example, if the real 
frame rate is only 5 fps, it only draws every fifth frame = (25/5). The result: 
fast and slow PCs see the same thing, but the faster one sees smoother 
graphics.</P>
<H2>Conclusion</H2>
<P style="MARGIN-BOTTOM: 12pt" class=MsoNormal>The purpose of this demo is to 
show that you can do frame rates properly without much effort. The result will 
be that your game <EM>can be enjoyed by more people</EM> because it always runs 
at the right speed. Dell is selling a server at the moment with multiple Intel 
Itanium processors in it. At the moment it costs 56000 US dollars, but I can 
predict it won't be long before we all have one. And, it <I>will</I> run 
Allegro! So plan for the future now.<BR><BR>Cheers,<BR>Pete<BR><BR 
style="mso-special-character: line-break"><![if !supportLineBreakNewLine]><BR 
style="mso-special-character: line-break"><![endif]></P></DIV>
<SCRIPT language=Javascript>
<!--

setonclickmethods();

// -->   
</SCRIPT>

<CENTER><!-- google_ad_section_start(weight=ignore) -->
<DIV style="VISIBILITY: hidden" id=fclinkback>
<P><FONT size=1 face="Verdana, Helvetica, Arial, sans-serif"><A id=fcfootergif 
href="http://www.fortunecity.com/" target=_new><IMG border=0 
src="Frame%20Rate%20Demos_files/fc_mp_logo_150x80.gif"></A><BR><A 
id=fcfooterhosting href="http://www.fortunecity.com/" target=_new>web 
hosting</A> • <A id=fcfooterdomains href="http://www.fortunecity.com/" 
target=_new>domain names</A> <BR><A id=fcfooterdesign 
href="http://www.fortunecity.com/web-design.shtml" target=_new>web design</A> • 
<A href="http://www.hotgames.com/" target=_new>online 
games</A><BR></FONT></P></DIV><!-- google_ad_section_end -->
<SCRIPT language=Javascript>
<!--

if(FCWindowWidth > 400) {                                                       

        document.getElementById('fclinkback').style.visibility = "visible";  
        document.getElementById('fcfootergif').search = '?sid=fcfootergif';
        document.getElementById('fcfooterhosting').search = '?sid=fcfooterhosting';
        document.getElementById('fcfooterdomains').search = '?sid=fcfooterdomains';
        document.getElementById('fcfooterdesign').search = '?sid=fcfooterdesign';

	if(fcadunit != 'adult') {

		if(FCWindowWidth > 700) {

			// ZEDO for channel:  FC Member Content Foot , publisher: FortuneCity.com , Ad Dimension: Super Banner - 728 x 90
			document.write('<scr'+'ipt language="JavaScript">var zflag_nid="895"; var zflag_cid="51"; var zflag_sid="1"; var zflag_width="728"; var zflag_height="90"; var zflag_sz="14"; </scr'+'ipt><scr'+'ipt language="JavaScript" src="http://d3.zedo.com/jsc/d3/fo.js"></scr'+'ipt>');

		}
		else {

			// ZEDO for channel:  FC Member Content Foot , publisher: FortuneCity.com , Ad Dimension: Full Banner - 468 x 60
			document.write('<scr'+'ipt language="JavaScript">var zflag_nid="895"; var zflag_cid="51"; var zflag_sid="1"; var zflag_width="468"; var zflag_height="60"; var zflag_sz="0"; </scr'+'ipt><scr'+'ipt language="JavaScript" src="http://d3.zedo.com/jsc/d3/fo.js"></scr'+'ipt>');

		}

		document.write('<scr'+'ipt type="text/javascript" src="http://fortunecity.us.intellitxt.com/intellitxt/front.asp?ipid=20722"></scr'+'ipt>');

		document.write('<scr'+'ipt type="text/javascript">');
		document.write('var dc_UnitID = 14;');
		document.write('var dc_PublisherID = 37950;');
		document.write('var dc_AdLinkColor = "blue";');
		document.write('var dc_adprod="ADL";');
		document.write('</scr'+'ipt>');

		if (document.cookie.indexOf('fcseenpop') == -1) {

			pop_domain = document.domain.substring(document.domain.indexOf('.'));

			expiry_date = new Date(new Date().getTime() + 86400000).toGMTString();		// 24 hours

			// ZEDO for channel:  FC Member Content Popunder , publisher: FortuneCity.com , Ad Dimension: Pixel/Popup - 1 x 1
			document.write('<scr'+'ipt language="JavaScript">var zflag_nid="895"; var zflag_cid="51"; var zflag_sid="1"; var zflag_width="1"; var zflag_height="1"; var zflag_sz="15"; </scr'+'ipt><scr'+'ipt language="JavaScript" src="http://d3.zedo.com/jsc/d3/fo.js"></scr'+'ipt>');

			document.cookie = 'fcseenpop=1; path=/; domain=' + pop_domain + '; expires=' + expiry_date;

		}
	}
}

// -->
</SCRIPT>
</CENTER>
<SCRIPT type=text/javascript>
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>

<SCRIPT type=text/javascript>
try {
var pageTracker = _gat._getTracker("UA-7234138-14");
pageTracker._setDomainName(".fortunecity.com");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>
</BODY></HTML>
