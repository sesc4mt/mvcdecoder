
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 

\chapter{MVC解码器原理与实现}
\label{cha:decoderprincipleandrealization}

%参见胡伟栋论文和张凤研论文
自2006年起，胡伟栋等开始着手编写一套视频编解码系统。至2010年初基本完成，编解码的过程基本符合MVC标准\cite{iso2009mvc}的描述。编写过程中，主要参考了《H.264 and MPEG-4 video compression, video coding for next-generation multimedia》\cite{richardson2003h}、T264项目\footnote{\href{http://sourceforge.net/projects/t264/}{http://sourceforge.net/projects/t264/}}和JMVC参考软件。代码参考了JMVC的框架设置。

\section{参考软件JMVC介绍}
\label{sec:introtojmvc}
JVT在发布MVC草案的同时还发布了MVC编解码的参考软件JMVM（Joint Multi-view Video Model）。MVC标准确立之后，JMVM改名为JMVC（Joint Multi-view Video Coding），陆续有新版本发布。我们的编解码器起初参考的是JMVC 4.2版，今年由于新发布的JMVC 7.2编解码结果与旧版并不兼容，我们又针对新版做了更正。

JMVC包括以下几个工程：
\begin{itemize}
\item H264AVCCommonLibStatic
\item H264AVCDecoderLibStatic
\item H264AVCEncoderLibStatic
\item H264AVCVideoIoLibStatic
\item MVCBitStreamAssembler
\item MVCBitStreamExtractor
\item DownConvertStatic
\item PSNRStatic
\item H264AVCDecoderLibTestStatic
\item H264AVCEncoderLibTestStatic
\end{itemize}

其中，DownConvertStatic是为了前向兼容；PSNRStatic是进行编码质量分析，与MVC编解码实现无关，不做介绍。

H264AVCCommonLibStatic包含编解码时都需要的一些函数，例如对读取一帧的属性、各类Filter函数、量化与反量化函数、宏块的变换与反变换操作等等。H264AVCDecoderLibStatic就是解码器的函数库，H264AVCEncoderLibStatic则是编码器函数库。H264AVCVideoIoLibStatic是进行视频文件读写操作的函数库。

由于MVC视频文件可能包含多路H.264视频，所以需要对码流进行打包，MVCBitStreamAssembler就是这个模块；相应的，MVCBitStreamExtractor就是从码流中抽取各路视频的模块。

除了函数库之外，JMVC还提供了两个工程演示调用库函数进行MVC编码和解码的过程，分别在H264AVCEncoderLibTestStatic和H264AVCDecoderLibTestStatic中。

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=\textwidth]{JMVCstructure}
\caption{JMVC编解码框架}
\label{fig:JMVCstructure}
\end{center}
\end{figure}

利用JMVC进行编解码的框架如图\ref{fig:JMVCstructure}所示。

编码器的输入为若干路YUV视频，一般是同一场景从若干不同角度拍摄的视频，有相同的分辨率并且经过时间同步和校准。YUV文件要求是4:2:0格式，每$2\times2=4$个像素由一个$2\times2$的亮度矩阵和两个$1\times1$的色度矩阵。亮度矩阵顾名思义表示了4个像素的亮度，两个色度矩阵表示像素红蓝两色的平均色度，如图\ref{fig:Barn-yuv}所示。
在编解码器开发期间，庞一、胡伟栋、张凤研等对编解码在帧级别的并行性进行了深入研究\cite{pang2009adaptive,yi2008parallelized}，并在编码器和解码器中都采用了帧并行的算法。

\begin{figure}[htbp]
\begin{center}
\includegraphics[scale=0.4]{Barn-yuv.eps}
\caption{原始图像(左上)和其Y'（左下）、U（右上）、V（右下）分量}
\label{fig:Barn-yuv}
\end{center}
\end{figure}

\section{自主开发的MVC解码器}
\label{sec:mvcdecoder}
%TODO 解码流程图
%TODO 解码器行为描述