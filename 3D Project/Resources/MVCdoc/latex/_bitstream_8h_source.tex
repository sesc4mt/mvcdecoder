\hypertarget{_bitstream_8h_source}{
\section{MVCCommonLib/Codec/Bitstream.h}
}


\begin{footnotesize}\begin{alltt}
00001 \textcolor{comment}{/************************************************************************}
00002 \textcolor{comment}{ *}
00003 \textcolor{comment}{ * MVC Codec}
00004 \textcolor{comment}{ * }
00005 \textcolor{comment}{ * History}
00006 \textcolor{comment}{ * 2008-11-29           Weidong Hu              Tsinghua University             R
      eorganize}
00007 \textcolor{comment}{ * 2006-2008            Weidong Hu              Tsinghua University             M
      odified from T264}
00008 \textcolor{comment}{ * }
00009 \textcolor{comment}{ ************************************************************************/}
00010 
00011 \textcolor{comment}{// Copied from T264 CODEC}
00012 
00013 \textcolor{comment}{/*****************************************************************************}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ *  T264 AVC CODEC}
00016 \textcolor{comment}{ *}
00017 \textcolor{comment}{ *  Copyright(C) 2004-2005 llcc <lcgate1@yahoo.com.cn>}
00018 \textcolor{comment}{ *               2004-2005 visionany <visionany@yahoo.com.cn>}
00019 \textcolor{comment}{ *  Ported to TI DSP Platform By YouXiaoQuan, HFUT-TI UNITED LAB,China      }
00020 \textcolor{comment}{ *               2004-2005 You Xiaoquan <YouXiaoquan@126.com>   }
00021 \textcolor{comment}{ *}
00022 \textcolor{comment}{ *  This program is free software ; you can redistribute it and/or modify}
00023 \textcolor{comment}{ *  it under the terms of the GNU General Public License as published by}
00024 \textcolor{comment}{ *  the Free Software Foundation ; either version 2 of the License, or}
00025 \textcolor{comment}{ *  (at your option) any later version.}
00026 \textcolor{comment}{ *}
00027 \textcolor{comment}{ *  This program is distributed in the hope that it will be useful,}
00028 \textcolor{comment}{ *  but WITHOUT ANY WARRANTY ; without even the implied warranty of}
00029 \textcolor{comment}{ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00030 \textcolor{comment}{ *  GNU General Public License for more details.}
00031 \textcolor{comment}{ *}
00032 \textcolor{comment}{ *  You should have received a copy of the GNU General Public License}
00033 \textcolor{comment}{ *  along with this program ; if not, write to the Free Software}
00034 \textcolor{comment}{ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA}
00035 \textcolor{comment}{ *}
00036 \textcolor{comment}{ ****************************************************************************/}
00037 
00038 \textcolor{comment}{/*****************************************************************************}
00039 \textcolor{comment}{ *}
00040 \textcolor{comment}{ *  XVID MPEG-4 VIDEO CODEC}
00041 \textcolor{comment}{ *  - Bitstream reader/writer inlined functions and constants-}
00042 \textcolor{comment}{ *}
00043 \textcolor{comment}{ *  Copyright (C) 2001-2003 Peter Ross <pross@xvid.org>}
00044 \textcolor{comment}{ *}
00045 \textcolor{comment}{ *  This program is free software ; you can redistribute it and/or modify}
00046 \textcolor{comment}{ *  it under the terms of the GNU General Public License as published by}
00047 \textcolor{comment}{ *  the Free Software Foundation ; either version 2 of the License, or}
00048 \textcolor{comment}{ *  (at your option) any later version.}
00049 \textcolor{comment}{ *}
00050 \textcolor{comment}{ *  This program is distributed in the hope that it will be useful,}
00051 \textcolor{comment}{ *  but WITHOUT ANY WARRANTY ; without even the implied warranty of}
00052 \textcolor{comment}{ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00053 \textcolor{comment}{ *  GNU General Public License for more details.}
00054 \textcolor{comment}{ *}
00055 \textcolor{comment}{ *  You should have received a copy of the GNU General Public License}
00056 \textcolor{comment}{ *  along with this program ; if not, write to the Free Software}
00057 \textcolor{comment}{ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA}
00058 \textcolor{comment}{ *}
00059 \textcolor{comment}{ * $Id: bitstream.h,v 1.8 2005/03/30 02:28:02 youxiaoquan Exp $}
00060 \textcolor{comment}{ *}
00061 \textcolor{comment}{ ****************************************************************************/}
00062 
00063 \textcolor{preprocessor}{#ifndef \_BITSTREAM\_H\_}
00064 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define \_BITSTREAM\_H\_}
00065 \textcolor{preprocessor}{}
00066 \textcolor{preprocessor}{#include "\hyperlink{_common_8h}{Common.h}"}
00067 
00068 \textcolor{comment}{/*****************************************************************************}
00069 \textcolor{comment}{ * Constants}
00070 \textcolor{comment}{ ****************************************************************************/}
00071 
00072 \textcolor{comment}{/* comment any #defs we dont use */}
00073 
\hypertarget{_bitstream_8h_source_l00074}{}\hyperlink{_bitstream_8h_abff7d25491a409504569e1dbfb4c8ff7}{00074} \textcolor{preprocessor}{#define VIDOBJ\_START\_CODE               0x00000100      }\textcolor{comment}{/* ..0x0000011f  */}
\hypertarget{_bitstream_8h_source_l00075}{}\hyperlink{_bitstream_8h_a33dc5a33a62c92f4e041a83d796c3999}{00075} \textcolor{preprocessor}{#define VIDOBJLAY\_START\_CODE    0x00000120      }\textcolor{comment}{/* ..0x0000012f */}
\hypertarget{_bitstream_8h_source_l00076}{}\hyperlink{_bitstream_8h_a5550f5a4cd5ab35e866a5a94124b2ad6}{00076} \textcolor{preprocessor}{#define VISOBJSEQ\_START\_CODE    0x000001b0}
\hypertarget{_bitstream_8h_source_l00077}{}\hyperlink{_bitstream_8h_af1f5dd21b194b74dd067b15ba49c2c0c}{00077} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define VISOBJSEQ\_STOP\_CODE             0x000001b1      }\textcolor{comment}{/* ??? */}
\hypertarget{_bitstream_8h_source_l00078}{}\hyperlink{_bitstream_8h_a1f5eb3933cb407baaad43527d029b837}{00078} \textcolor{preprocessor}{#define USERDATA\_START\_CODE             0x000001b2}
\hypertarget{_bitstream_8h_source_l00079}{}\hyperlink{_bitstream_8h_a3efc559c506c180fa10445439123972a}{00079} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define GRPOFVOP\_START\_CODE             0x000001b3}
00080 \textcolor{preprocessor}{}\textcolor{comment}{/*#define VIDSESERR\_ERROR\_CODE  0x000001b4 */}
\hypertarget{_bitstream_8h_source_l00081}{}\hyperlink{_bitstream_8h_ac6756b1879e3f5778e33b3ffb2792a4c}{00081} \textcolor{preprocessor}{#define VISOBJ\_START\_CODE               0x000001b5}
\hypertarget{_bitstream_8h_source_l00082}{}\hyperlink{_bitstream_8h_a25dcf1a2c9a296ea3f643d7851f11c29}{00082} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define VOP\_START\_CODE                  0x000001b6}
00083 \textcolor{preprocessor}{}\textcolor{comment}{/*#define STUFFING\_START\_CODE   0x000001c3 */}
00084 
00085 
\hypertarget{_bitstream_8h_source_l00086}{}\hyperlink{_bitstream_8h_a810c5baf4854f610e6d80752dc4691d1}{00086} \textcolor{preprocessor}{#define VISOBJ\_TYPE\_VIDEO                               1}
00087 \textcolor{preprocessor}{}\textcolor{comment}{/*#define VISOBJ\_TYPE\_STILLTEXTURE      2 */}
00088 \textcolor{comment}{/*#define VISOBJ\_TYPE\_MESH              3 */}
00089 \textcolor{comment}{/*#define VISOBJ\_TYPE\_FBA               4 */}
00090 \textcolor{comment}{/*#define VISOBJ\_TYPE\_3DMESH            5 */}
00091 
00092 
\hypertarget{_bitstream_8h_source_l00093}{}\hyperlink{_bitstream_8h_ac45db4c1cd965589aeba6704d0544ee7}{00093} \textcolor{preprocessor}{#define VIDOBJLAY\_TYPE\_SIMPLE                   1}
00094 \textcolor{preprocessor}{}\textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_SIMPLE\_SCALABLE    2 */}
00095 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_CORE                           3 */}
00096 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_MAIN                           4 */}
00097 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_NBIT                           5 */}
00098 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_ANIM\_TEXT                      6 */}
00099 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_ANIM\_MESH                      7 */}
00100 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_SIMPLE\_FACE            8 */}
00101 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_STILL\_SCALABLE         9 */}
\hypertarget{_bitstream_8h_source_l00102}{}\hyperlink{_bitstream_8h_a3aac1a74a15f33d3796fa5da0cb1d7a2}{00102} \textcolor{preprocessor}{#define VIDOBJLAY\_TYPE\_ART\_SIMPLE               10}
00103 \textcolor{preprocessor}{}\textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_CORE\_SCALABLE          11 */}
00104 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_ACE                            12 */}
00105 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_ADVANCED\_SCALABLE\_TEXTURE 13 */}
00106 \textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_SIMPLE\_FBA                     14 */}
00107 \textcolor{comment}{/*#define VIDEOJLAY\_TYPE\_SIMPLE\_STUDIO    15*/}
00108 \textcolor{comment}{/*#define VIDEOJLAY\_TYPE\_CORE\_STUDIO      16*/}
\hypertarget{_bitstream_8h_source_l00109}{}\hyperlink{_bitstream_8h_a58bd767d5ee49cbf3c6bf514c7f69bd2}{00109} \textcolor{preprocessor}{#define VIDOBJLAY\_TYPE\_ASP              17}
00110 \textcolor{preprocessor}{}\textcolor{comment}{/*#define VIDOBJLAY\_TYPE\_FGS              18*/}
00111 
00112 
00113 \textcolor{comment}{/*#define VIDOBJLAY\_AR\_SQUARE           1 */}
00114 \textcolor{comment}{/*#define VIDOBJLAY\_AR\_625TYPE\_43       2 */}
00115 \textcolor{comment}{/*#define VIDOBJLAY\_AR\_525TYPE\_43       3 */}
00116 \textcolor{comment}{/*#define VIDOBJLAY\_AR\_625TYPE\_169      8 */}
00117 \textcolor{comment}{/*#define VIDOBJLAY\_AR\_525TYPE\_169      9 */}
\hypertarget{_bitstream_8h_source_l00118}{}\hyperlink{_bitstream_8h_a49615f909a819ab6ce89ac208715482e}{00118} \textcolor{preprocessor}{#define VIDOBJLAY\_AR\_EXTPAR                             15}
00119 \textcolor{preprocessor}{}
00120 
\hypertarget{_bitstream_8h_source_l00121}{}\hyperlink{_bitstream_8h_a61a2da7986218293dd7b823a7cce1844}{00121} \textcolor{preprocessor}{#define VIDOBJLAY\_SHAPE\_RECTANGULAR             0}
\hypertarget{_bitstream_8h_source_l00122}{}\hyperlink{_bitstream_8h_aaedb24d8f3e2741a07bcec0275c47e9b}{00122} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define VIDOBJLAY\_SHAPE\_BINARY                  1}
\hypertarget{_bitstream_8h_source_l00123}{}\hyperlink{_bitstream_8h_a412328d1766f979f3d38e477224cc1ee}{00123} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define VIDOBJLAY\_SHAPE\_BINARY\_ONLY             2}
\hypertarget{_bitstream_8h_source_l00124}{}\hyperlink{_bitstream_8h_a7a7ae8783626f8399d7422e3fe469fd3}{00124} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define VIDOBJLAY\_SHAPE\_GRAYSCALE               3}
00125 \textcolor{preprocessor}{}
00126 
\hypertarget{_bitstream_8h_source_l00127}{}\hyperlink{_bitstream_8h_a0c741ee93be1feaaa180348399eda91f}{00127} \textcolor{preprocessor}{#define SPRITE\_NONE             0}
\hypertarget{_bitstream_8h_source_l00128}{}\hyperlink{_bitstream_8h_a06e7f9f76ced7eed593b14a9e084fc1d}{00128} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define SPRITE\_STATIC   1}
\hypertarget{_bitstream_8h_source_l00129}{}\hyperlink{_bitstream_8h_a1af0fda3992f0f31fedd7242baf25447}{00129} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define SPRITE\_GMC              2}
00130 \textcolor{preprocessor}{}
00131 
00132 
\hypertarget{_bitstream_8h_source_l00133}{}\hyperlink{_bitstream_8h_a0ff1b842437ed8e28ed060c2b19220df}{00133} \textcolor{preprocessor}{#define READ\_MARKER()   BitstreamSkip(bs, 1)}
\hypertarget{_bitstream_8h_source_l00134}{}\hyperlink{_bitstream_8h_a4f1e9b9ced4a14e93577c5875424643a}{00134} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define WRITE\_MARKER()  BitstreamPutBit(bs, 1)}
00135 \textcolor{preprocessor}{}
00136 \textcolor{comment}{/* vop coding types  */}
00137 \textcolor{comment}{/* intra, prediction, backward, sprite, not\_coded */}
\hypertarget{_bitstream_8h_source_l00138}{}\hyperlink{_bitstream_8h_af8c67a960cc502d8130020f116f5bd7f}{00138} \textcolor{preprocessor}{#define I\_VOP   0}
\hypertarget{_bitstream_8h_source_l00139}{}\hyperlink{_bitstream_8h_ae26c00dbf5c8c92fe4513b64f1135154}{00139} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define P\_VOP   1}
\hypertarget{_bitstream_8h_source_l00140}{}\hyperlink{_bitstream_8h_ad08ba34fde9c839a62e98a841c961caf}{00140} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define B\_VOP   2}
\hypertarget{_bitstream_8h_source_l00141}{}\hyperlink{_bitstream_8h_a7a44beaaf4bfa528ff1368e087d5a374}{00141} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define S\_VOP   3}
\hypertarget{_bitstream_8h_source_l00142}{}\hyperlink{_bitstream_8h_a4076c55965ae4f8f034c9e62eef0ea00}{00142} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define N\_VOP   4}
00143 \textcolor{preprocessor}{}
00144 \textcolor{comment}{/* resync-specific */}
\hypertarget{_bitstream_8h_source_l00145}{}\hyperlink{_bitstream_8h_a4601bdcd7517a32258a47870774a0d22}{00145} \textcolor{preprocessor}{#define NUMBITS\_VP\_RESYNC\_MARKER  17}
\hypertarget{_bitstream_8h_source_l00146}{}\hyperlink{_bitstream_8h_afe4d4b8917759e79abff36fab5284a07}{00146} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define RESYNC\_MARKER 1}
00147 \textcolor{preprocessor}{}
00148 
\hypertarget{_bitstream_8h_source_l00149}{}\hyperlink{struct_bitstream}{00149} \textcolor{keyword}{typedef} \textcolor{keyword}{struct}
00150 \{
\hypertarget{_bitstream_8h_source_l00151}{}\hyperlink{struct_bitstream_a2b3b7e703efb5f16a9b122862f6342ff}{00151}     \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} bufa;
\hypertarget{_bitstream_8h_source_l00152}{}\hyperlink{struct_bitstream_af88938159f6b589af03d736e9fe8119e}{00152}     \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} bufb;
\hypertarget{_bitstream_8h_source_l00153}{}\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{00153}     \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} buf;
\hypertarget{_bitstream_8h_source_l00154}{}\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{00154}     \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} pos;
\hypertarget{_bitstream_8h_source_l00155}{}\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{00155}     \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} *tail;
\hypertarget{_bitstream_8h_source_l00156}{}\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{00156}     \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} *start;
\hypertarget{_bitstream_8h_source_l00157}{}\hyperlink{struct_bitstream_a56ea589bea2ad26a4512ff556b055fd8}{00157}     \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} length;
\hypertarget{_bitstream_8h_source_l00158}{}\hyperlink{struct_bitstream_a3234ef24b4ec8a9d06731d4f2db67418}{00158}     \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} initpos;
00159 \}
00160 \hyperlink{struct_bitstream}{Bitstream};
00161 
00162 \textcolor{comment}{/* initialise bitstream structure */}
00163 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00164 BitstreamInit(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs,
00165                           \textcolor{keywordtype}{void} *\textcolor{keyword}{const} bitstream,
00166                           \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} length)
00167 \{
00168         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} tmp;
00169         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} bitpos;
00170         \hyperlink{_types_8h_a9c9021e43aafc3d7fd2068cd742bad2c}{ptr_t} adjbitstream = (\hyperlink{_types_8h_a9c9021e43aafc3d7fd2068cd742bad2c}{ptr_t})bitstream;
00171 
00172         \textcolor{comment}{/*}
00173 \textcolor{comment}{         * Start the stream on a uint32\_t boundary, by rounding down to the}
00174 \textcolor{comment}{         * previous uint32\_t and skipping the intervening bytes.}
00175 \textcolor{comment}{         */}
00176         bitpos = (\hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t})((\textcolor{keyword}{sizeof}(\hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t})-1) & (\textcolor{keywordtype}{size\_t})bitstream);
00177         adjbitstream = adjbitstream - bitpos;
00178         bs->\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{start} = bs->\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{tail} = (\hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} *) adjbitstream;
00179 
00180         tmp = *bs->\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{start};
00181 \textcolor{preprocessor}{#ifndef ARCH\_IS\_BIG\_ENDIAN}
00182 \textcolor{preprocessor}{}        \hyperlink{_macros_8h_acd886eee9738d4807d25c1baac1e839e}{BSWAP}(tmp);
00183 \textcolor{preprocessor}{#endif}
00184 \textcolor{preprocessor}{}        bs->\hyperlink{struct_bitstream_a2b3b7e703efb5f16a9b122862f6342ff}{bufa} = tmp;
00185 
00186         tmp = *(bs->\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{start} + 1);
00187 \textcolor{preprocessor}{#ifndef ARCH\_IS\_BIG\_ENDIAN}
00188 \textcolor{preprocessor}{}        \hyperlink{_macros_8h_acd886eee9738d4807d25c1baac1e839e}{BSWAP}(tmp);
00189 \textcolor{preprocessor}{#endif}
00190 \textcolor{preprocessor}{}        bs->\hyperlink{struct_bitstream_af88938159f6b589af03d736e9fe8119e}{bufb} = tmp;
00191 
00192         bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf} = 0;
00193         bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} = bs->\hyperlink{struct_bitstream_a3234ef24b4ec8a9d06731d4f2db67418}{initpos} = bitpos*8;
00194         bs->\hyperlink{struct_bitstream_a56ea589bea2ad26a4512ff556b055fd8}{length} = length;
00195 \}
00196 
00197 
00198 \textcolor{comment}{/* reset bitstream state */}
00199 
00200 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00201 BitstreamReset(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00202 \{
00203         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} tmp;
00204 
00205         bs->\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{tail} = bs->\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{start};
00206 
00207         tmp = *bs->\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{start};
00208 \textcolor{preprocessor}{#ifndef ARCH\_IS\_BIG\_ENDIAN}
00209 \textcolor{preprocessor}{}        \hyperlink{_macros_8h_acd886eee9738d4807d25c1baac1e839e}{BSWAP}(tmp);
00210 \textcolor{preprocessor}{#endif}
00211 \textcolor{preprocessor}{}        bs->\hyperlink{struct_bitstream_a2b3b7e703efb5f16a9b122862f6342ff}{bufa} = tmp;
00212 
00213         tmp = *(bs->\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{start} + 1);
00214 \textcolor{preprocessor}{#ifndef ARCH\_IS\_BIG\_ENDIAN}
00215 \textcolor{preprocessor}{}        \hyperlink{_macros_8h_acd886eee9738d4807d25c1baac1e839e}{BSWAP}(tmp);
00216 \textcolor{preprocessor}{#endif}
00217 \textcolor{preprocessor}{}        bs->\hyperlink{struct_bitstream_af88938159f6b589af03d736e9fe8119e}{bufb} = tmp;
00218 
00219         bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf} = 0;
00220         bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} = bs->\hyperlink{struct_bitstream_a3234ef24b4ec8a9d06731d4f2db67418}{initpos};
00221 \}
00222 
00223 
00224 \textcolor{comment}{/* reads n bits from bitstream without changing the stream pos */}
00225 
00226 \textcolor{keyword}{static} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} \_\_inline
00227 BitstreamShowBits(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs,
00228                                   \textcolor{keyword}{const} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} bits)
00229 \{
00230         \textcolor{keywordtype}{int} nbit = (bits + bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos}) - 32;
00231 
00232         \textcolor{keywordflow}{if} (nbit > 0) \{
00233                 \textcolor{keywordflow}{return} ((bs->\hyperlink{struct_bitstream_a2b3b7e703efb5f16a9b122862f6342ff}{bufa} & (0xffffffff >> bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos})) << nbit) | (bs->
00234                                                                                                                                  
      bufb >> (32 -
00235                                                                                                                                                  
       nbit));
00236         \} \textcolor{keywordflow}{else} \{
00237                 \textcolor{keywordflow}{return} (bs->\hyperlink{struct_bitstream_a2b3b7e703efb5f16a9b122862f6342ff}{bufa} & (0xffffffff >> bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos})) >> (32 - bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} - bi
      ts);
00238         \}
00239 \}
00240 
00241 
00242 \textcolor{comment}{/* skip n bits forward in bitstream */}
00243 
00244 \textcolor{keyword}{static} \_\_inline \textcolor{keywordtype}{void}
00245 BitstreamSkip(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs,
00246                           \textcolor{keyword}{const} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} bits)
00247 \{
00248         bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} += bits;
00249 
00250         \textcolor{keywordflow}{if} (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} >= 32) \{
00251                 \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} tmp;
00252 
00253                 bs->\hyperlink{struct_bitstream_a2b3b7e703efb5f16a9b122862f6342ff}{bufa} = bs->\hyperlink{struct_bitstream_af88938159f6b589af03d736e9fe8119e}{bufb};
00254                 tmp = *((\hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} *) bs->\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{tail} + 2);
00255 \textcolor{preprocessor}{#ifndef ARCH\_IS\_BIG\_ENDIAN}
00256 \textcolor{preprocessor}{}                \hyperlink{_macros_8h_acd886eee9738d4807d25c1baac1e839e}{BSWAP}(tmp);
00257 \textcolor{preprocessor}{#endif}
00258 \textcolor{preprocessor}{}                bs->\hyperlink{struct_bitstream_af88938159f6b589af03d736e9fe8119e}{bufb} = tmp;
00259                 bs->\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{tail}++;
00260                 bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} -= 32;
00261         \}
00262 \}
00263 
00264 
00265 \textcolor{comment}{/* number of bits to next byte alignment */}
00266 \textcolor{keyword}{static} \_\_inline \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t}
00267 BitstreamNumBitsToByteAlign(\hyperlink{struct_bitstream}{Bitstream} *bs)
00268 \{
00269         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} n = (32 - bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos}) % 8;
00270         \textcolor{keywordflow}{return} n == 0 ? 8 : n;
00271 \}
00272 
00273 
00274 \textcolor{comment}{/* show nbits from next byte alignment */}
00275 \textcolor{keyword}{static} \_\_inline \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t}
00276 BitstreamShowBitsFromByteAlign(\hyperlink{struct_bitstream}{Bitstream} *bs, \textcolor{keywordtype}{int} bits)
00277 \{
00278         \textcolor{keywordtype}{int} bspos = bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} + BitstreamNumBitsToByteAlign(bs);
00279         \textcolor{keywordtype}{int} nbit = (bits + bspos) - 32;
00280 
00281         \textcolor{keywordflow}{if} (bspos >= 32) \{
00282                 \textcolor{keywordflow}{return} bs->\hyperlink{struct_bitstream_af88938159f6b589af03d736e9fe8119e}{bufb} >> (32 - nbit);
00283         \} \textcolor{keywordflow}{else}  \textcolor{keywordflow}{if} (nbit > 0) \{
00284                 \textcolor{keywordflow}{return} ((bs->\hyperlink{struct_bitstream_a2b3b7e703efb5f16a9b122862f6342ff}{bufa} & (0xffffffff >> bspos)) << nbit) | (bs->
00285                                                                                                                                  
      bufb >> (32 -
00286                                                                                                                                                  
       nbit));
00287         \} \textcolor{keywordflow}{else} \{
00288                 \textcolor{keywordflow}{return} (bs->\hyperlink{struct_bitstream_a2b3b7e703efb5f16a9b122862f6342ff}{bufa} & (0xffffffff >> bspos)) >> (32 - bspos - bits);
      
00289         \}
00290 
00291 \}
00292 
00293 
00294 
00295 \textcolor{comment}{/* move forward to the next byte boundary */}
00296 
00297 \textcolor{keyword}{static} \_\_inline \textcolor{keywordtype}{void}
00298 BitstreamByteAlign(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00299 \{
00300         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} remainder = bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} % 8;
00301 
00302         \textcolor{keywordflow}{if} (remainder) \{
00303                 BitstreamSkip(bs, 8 - remainder);
00304         \}
00305 \}
00306 
00307 
00308 \textcolor{comment}{/* bitstream length (unit bits) */}
00309 
00310 \textcolor{keyword}{static} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} \_\_inline
00311 BitstreamPos(\textcolor{keyword}{const} \hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00312 \{
00313         \textcolor{keywordflow}{return}((\hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t})(8*((\hyperlink{_types_8h_a9c9021e43aafc3d7fd2068cd742bad2c}{ptr_t})bs->\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{tail} - (\hyperlink{_types_8h_a9c9021e43aafc3d7fd2068cd742bad2c}{ptr_t})bs->\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{start}) + bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} - bs->
      \hyperlink{struct_bitstream_a3234ef24b4ec8a9d06731d4f2db67418}{initpos}));
00314 \}
00315 
00316 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00317 BitstreamFlush(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs)
00318 \{
00319     \textcolor{keywordflow}{if} (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos}) \{
00320         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} b = bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf};
00321 
00322 \textcolor{preprocessor}{#ifndef ARCH\_IS\_BIG\_ENDIAN}
00323 \textcolor{preprocessor}{}        \hyperlink{_macros_8h_acd886eee9738d4807d25c1baac1e839e}{BSWAP}(b);
00324 \textcolor{preprocessor}{#endif}
00325 \textcolor{preprocessor}{}        *bs->\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{tail} = b;
00326     \}
00327 \}
00328 
00329 \textcolor{comment}{/*}
00330 \textcolor{comment}{ * flush the bitstream & return length (unit bytes)}
00331 \textcolor{comment}{ * NOTE: assumes no futher bitstream functions will be called.}
00332 \textcolor{comment}{ */}
00333 
00334 \textcolor{keyword}{static} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} \_\_inline
00335 BitstreamLength(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00336 \{
00337         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} len = (\hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t})((\hyperlink{_types_8h_a9c9021e43aafc3d7fd2068cd742bad2c}{ptr_t})bs->\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{tail} - (\hyperlink{_types_8h_a9c9021e43aafc3d7fd2068cd742bad2c}{ptr_t})bs->\hyperlink{struct_bitstream_a4c2cb09a4fee7ed90d05f8b40914911e}{start});
00338 
00339     \textcolor{keywordflow}{if} (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos})
00340         len += (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} + 7) / 8;
00341         \textcolor{comment}{/* initpos is always on a byte boundary */}
00342         \textcolor{keywordflow}{if} (bs->\hyperlink{struct_bitstream_a3234ef24b4ec8a9d06731d4f2db67418}{initpos})
00343                 len -= bs->\hyperlink{struct_bitstream_a3234ef24b4ec8a9d06731d4f2db67418}{initpos}/8;
00344 
00345         \textcolor{keywordflow}{return} len;
00346 \}
00347 
00348 
00349 \textcolor{comment}{/* move bitstream position forward by n bits and write out buffer if needed */}
00350 
00351 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00352 BitstreamForward(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs,
00353                                  \textcolor{keyword}{const} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} bits)
00354 \{
00355         bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} += bits;
00356 
00357         \textcolor{keywordflow}{if} (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} >= 32) \{
00358                 \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} b = bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf};
00359 
00360 \textcolor{preprocessor}{#ifndef ARCH\_IS\_BIG\_ENDIAN}
00361 \textcolor{preprocessor}{}                \hyperlink{_macros_8h_acd886eee9738d4807d25c1baac1e839e}{BSWAP}(b);
00362 \textcolor{preprocessor}{#endif}
00363 \textcolor{preprocessor}{}                *bs->\hyperlink{struct_bitstream_addd740548c260796cf01e55597f749c6}{tail}++ = b;
00364                 bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf} = 0;
00365                 bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} -= 32;
00366         \}
00367 \}
00368 
00369 \textcolor{comment}{/* read n bits from bitstream */}
00370 
00371 \textcolor{keyword}{static} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} \_\_inline
00372 BitstreamGetBits(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs,
00373                                  \textcolor{keyword}{const} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} n)
00374 \{
00375         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} ret = BitstreamShowBits(bs, n);
00376 
00377         BitstreamSkip(bs, n);
00378         \textcolor{keywordflow}{return} ret;
00379 \}
00380 
00381 
00382 \textcolor{comment}{/* read single bit from bitstream */}
00383 
00384 \textcolor{keyword}{static} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} \_\_inline
00385 BitstreamGetBit(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00386 \{
00387         \textcolor{keywordflow}{return} BitstreamGetBits(bs, 1);
00388 \}
00389 
00390 
00391 \textcolor{comment}{/* write single bit to bitstream */}
00392 
00393 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00394 BitstreamPutBit(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs,
00395                                 \textcolor{keyword}{const} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} bit)
00396 \{
00397         \textcolor{keywordflow}{if} (bit)
00398                 bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf} |= (0x80000000 >> bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos});
00399 
00400         BitstreamForward(bs, 1);
00401 \}
00402 
00403 
00404 \textcolor{comment}{/* write n bits to bitstream */}
00405 
00406 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00407 BitstreamPutBits(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs,
00408                                  \textcolor{keyword}{const} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} value,
00409                                  \textcolor{keyword}{const} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} size)
00410 \{
00411         \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} shift = 32 - bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} - size;
00412 
00413         \textcolor{keywordflow}{if} (shift <= 32) \{
00414                 bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf} |= value << shift;
00415                 BitstreamForward(bs, size);
00416         \} \textcolor{keywordflow}{else} \{
00417                 \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} remainder;
00418 
00419                 shift = size - (32 - bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos});
00420                 bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf} |= value >> shift;
00421                 BitstreamForward(bs, size - shift);
00422                 remainder = shift;
00423 
00424                 shift = 32 - shift;
00425 
00426                 bs->\hyperlink{struct_bitstream_aa6e7d5fa7c3bcfaac4cda5c4b07f8aa1}{buf} |= value << shift;
00427                 BitstreamForward(bs, remainder);
00428         \}
00429 \}
00430 
00431 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} stuffing\_codes[8] =
00432 \{
00433                 \textcolor{comment}{/* nbits     stuffing code */}
00434         0,              \textcolor{comment}{/* 1          0 */}
00435         1,              \textcolor{comment}{/* 2          01 */}
00436         3,              \textcolor{comment}{/* 3          011 */}
00437         7,              \textcolor{comment}{/* 4          0111 */}
00438         0xf,    \textcolor{comment}{/* 5          01111 */}
00439         0x1f,   \textcolor{comment}{/* 6          011111 */}
00440         0x3f,   \textcolor{comment}{/* 7          0111111 */}
00441         0x7f,   \textcolor{comment}{/* 8          01111111 */}
00442 \};
00443 
00444 \textcolor{comment}{/* pad bitstream to the next byte boundary */}
00445 
00446 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00447 BitstreamPad(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00448 \{
00449         \textcolor{keywordtype}{int} bits = 8 - (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} % 8);
00450         \textcolor{keywordflow}{if} (bits < 8)
00451                 BitstreamPutBits(bs, stuffing\_codes[bits - 1], bits);
00452 \}
00453 
00454 
00455 \textcolor{comment}{/*}
00456 \textcolor{comment}{ * pad bitstream to the next byte boundary}
00457 \textcolor{comment}{ * alway pad: even if currently at the byte boundary}
00458 \textcolor{comment}{ */}
00459 
00460 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00461 BitstreamPadAlways(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00462 \{
00463         \textcolor{keywordtype}{int} bits = 8 - (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} % 8);
00464         BitstreamPutBits(bs, stuffing\_codes[bits - 1], bits);
00465 \}
00466 
00467 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00468 BitstreamPadZero(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00469 \{
00470     \textcolor{keywordtype}{int} bits = 8 - (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} % 8);
00471     \textcolor{keywordflow}{if} (bits < 8)
00472         BitstreamPutBits(bs, 0, bits);
00473 \}
00474 \textcolor{comment}{//for CABAC}
00475 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00476 BitstreamPadOneA(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00477 \{
00478         \textcolor{keywordtype}{int} bits = 8 - (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} % 8);
00479         \textcolor{keywordflow}{if} (bits<=8 && bits>0)
00480                 BitstreamPutBits(bs, 1<<(bits-1), bits);
00481 \}
00482 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00483 BitstreamPadOne(\hyperlink{struct_bitstream}{Bitstream} * \textcolor{keyword}{const} bs)
00484 \{
00485         \textcolor{keywordtype}{int} bits = 8 - (bs->\hyperlink{struct_bitstream_ac7479c4c4e57d10bbfdd90baf6e731a4}{pos} % 8);
00486         \textcolor{keywordflow}{if} (bits<8 && bits>0)
00487                 BitstreamPutBits(bs, 1<<(bits-1), bits);
00488 \}
00490 \textcolor{comment}{// exp-golomb}
00491 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00492 eg\_write(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs, \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} code\_num)
00493 \{
00494     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} tmp = code\_num + 1;
00495     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} m, info;
00496   
00497     \textcolor{keywordflow}{if} (code\_num != 0)
00498     \{
00499         m = 0;
00500        
00501         \textcolor{keywordflow}{while} (tmp)
00502         \{
00503             tmp >>= 1;
00504             m ++;
00505         \}
00506 
00507         m --;
00508         
00509         info = code\_num + 1 - (1 << m);
00510         BitstreamPutBits(bs, 1, m + 1);
00511         BitstreamPutBits(bs, info, m);
00512     \}
00513     \textcolor{keywordflow}{else}
00514     \{
00515         BitstreamPutBits(bs, 1, 1);
00516     \}
00517 \}
00518 
00519 \textcolor{keyword}{static} \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} \_\_inline
00520 eg\_read(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs)
00521 \{
00522     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} m, info;
00523     
00524     m = 0;
00525     
00526     \textcolor{keywordflow}{while} (!BitstreamGetBit(bs))
00527     \{
00528         m ++;
00529     \}
00530     
00531     \textcolor{keywordflow}{if} (m == 0)
00532         \textcolor{keywordflow}{return} 0;
00533 
00534     info = BitstreamGetBits(bs, m);
00535     
00536     \textcolor{keywordflow}{return} (1 << m) + info - 1;
00537 \}
00538 
\hypertarget{_bitstream_8h_source_l00539}{}\hyperlink{_bitstream_8h_a3619cb729f31034ff847cbfd0730fce9}{00539} \textcolor{preprocessor}{#define eg\_write\_ue eg\_write}
\hypertarget{_bitstream_8h_source_l00540}{}\hyperlink{_bitstream_8h_acad61027e3182912d2b9d95180d45250}{00540} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_read\_ue eg\_read}
\hypertarget{_bitstream_8h_source_l00541}{}\hyperlink{_bitstream_8h_af690deb7a81fc44af3c41dfe5d715468}{00541} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_write\_direct BitstreamPutBits}
\hypertarget{_bitstream_8h_source_l00542}{}\hyperlink{_bitstream_8h_a62eb10ad34743e34384612d0fc2e77ea}{00542} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_write\_direct1 BitstreamPutBit}
\hypertarget{_bitstream_8h_source_l00543}{}\hyperlink{_bitstream_8h_a3474bd178129247b388e870a0bd602a3}{00543} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_read\_direct BitstreamGetBits}
\hypertarget{_bitstream_8h_source_l00544}{}\hyperlink{_bitstream_8h_a930f8a3acc36d15b74015dd4579f485c}{00544} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_read\_direct1 BitstreamGetBit}
\hypertarget{_bitstream_8h_source_l00545}{}\hyperlink{_bitstream_8h_ae09cd1235b1976cf290bee9c7367ddd5}{00545} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_read\_skip BitstreamSkip}
\hypertarget{_bitstream_8h_source_l00546}{}\hyperlink{_bitstream_8h_a89ddca586685b00a8a2fc90ec3514172}{00546} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_show BitstreamShowBits}
\hypertarget{_bitstream_8h_source_l00547}{}\hyperlink{_bitstream_8h_a61fc36305218f7be0282e50aac1b9e40}{00547} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_init BitstreamInit}
\hypertarget{_bitstream_8h_source_l00548}{}\hyperlink{_bitstream_8h_a53785f0677c9615aca67cddf358fa337}{00548} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_align BitstreamPadZero}
\hypertarget{_bitstream_8h_source_l00549}{}\hyperlink{_bitstream_8h_aabc09bc7d3d7c6f1b928b0f8cc7da050}{00549} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define bs\_t Bitstream}
\hypertarget{_bitstream_8h_source_l00550}{}\hyperlink{_bitstream_8h_a0a0225b45555db00cd5e082d335ee484}{00550} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_len BitstreamLength}
\hypertarget{_bitstream_8h_source_l00551}{}\hyperlink{_bitstream_8h_a873dc424d3fab9c5610a476fe5a115f3}{00551} \textcolor{preprocessor}{}\textcolor{preprocessor}{#define eg\_flush BitstreamFlush}
00552 \textcolor{preprocessor}{}
00553 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00554 eg\_write\_se(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs, \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} k)
00555 \{
00556     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} code\_num;
00557 
00558     code\_num = (k > 0) ? (k << 1) - 1 : (-k) << 1;
00559 
00560     \hyperlink{_bitstream_8h_a3619cb729f31034ff847cbfd0730fce9}{eg_write_ue}(bs, code\_num);    
00561 \}
00562 
00563 \textcolor{keyword}{static} \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} \_\_inline
00564 eg\_read\_se(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs)
00565 \{
00566     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} k;
00567     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} code\_num = \hyperlink{_bitstream_8h_acad61027e3182912d2b9d95180d45250}{eg_read_ue}(bs);
00568     
00569     k = (code\_num & 1) ? (code\_num + 1) >> 1 : -(code\_num >> 1);
00570     
00571     \textcolor{keywordflow}{return} k;
00572 \}
00573 
00574 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \_\_inline
00575 eg\_write\_te(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs, \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} x, \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} code\_num)
00576 \{
00577     x == 1 ? BitstreamPutBit(bs, !code\_num) : \hyperlink{_bitstream_8h_a3619cb729f31034ff847cbfd0730fce9}{eg_write_ue}(bs, code\_num);
00578 \}
00579 
00580 \textcolor{keyword}{static} \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} \_\_inline
00581 eg\_read\_te(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs, \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} x)
00582 \{
00583     \textcolor{keywordflow}{return} x == 1 ? (!BitstreamGetBit(bs)) : \hyperlink{_bitstream_8h_acad61027e3182912d2b9d95180d45250}{eg_read_ue}(bs);
00584 \}
00585 
00586 \textcolor{keyword}{static} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} \_\_inline
00587 eg\_size\_ue(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} , \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} code\_num)
00588 \{
00589     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} tmp = code\_num + 1;
00590     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} m;
00591 
00592     \textcolor{keywordflow}{if} (code\_num != 0)
00593     \{
00594         m = 0;
00595 
00596         \textcolor{keywordflow}{while} (tmp)
00597         \{
00598             tmp >>= 1;
00599             m ++;
00600         \}
00601 
00602         m --;
00603 
00604         \textcolor{keywordflow}{return} m + m + 1;
00605     \}
00606     \textcolor{keywordflow}{else}
00607     \{
00608         \textcolor{keywordflow}{return} 1;
00609     \}
00610 \}
00611 
00612 \textcolor{keyword}{static} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} \_\_inline
00613 eg\_size\_se(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs, \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} k)
00614 \{
00615     \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} code\_num;
00616 
00617     code\_num = (k > 0) ? (k << 1) - 1 : (-k) << 1;
00618 
00619     \textcolor{keywordflow}{return} eg\_size\_ue(bs, code\_num);    
00620 \}
00621 
00622 \textcolor{keyword}{static} \hyperlink{_types_8h_a04909d1366bb244ff2482beb51635f37}{uint32_t} \_\_inline
00623 eg\_size\_te(\hyperlink{struct_bitstream}{Bitstream}* \textcolor{keyword}{const} bs, \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} x, \hyperlink{_types_8h_a115ba3a1b24a8702355c5dbd61ce01e0}{int32_t} k)
00624 \{
00625     \textcolor{keywordflow}{if} (x > 0)
00626     \{
00627         \textcolor{keywordflow}{if} (x == 1)
00628             \textcolor{keywordflow}{return} 1;
00629 
00630         \textcolor{keywordflow}{return} eg\_size\_ue(bs, k);
00631     \}
00632     
00633     \textcolor{keywordflow}{return} 0;
00634 \}
00635 \textcolor{comment}{/*}
00636 \textcolor{comment}{static void \_\_inline}
00637 \textcolor{comment}{eg\_write\_me(Bitstream* const bs, int32\_t cbp)}
00638 \textcolor{comment}{\{}
00639 \textcolor{comment}{\}}
00640 \textcolor{comment}{}
00641 \textcolor{comment}{static int32\_t \_\_inline}
00642 \textcolor{comment}{eg\_read\_me(Bitstream* const bs)}
00643 \textcolor{comment}{\{}
00644 \textcolor{comment}{\}}
00645 \textcolor{comment}{*/}
00646 
00647 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* \_BITSTREAM\_H\_ */}
\end{alltt}\end{footnotesize}
